<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.helpme.travel.module.host.HostMpp">

	<resultMap id="resultMapObj" type="com.helpme.travel.module.host.Host"></resultMap>

	<select id="selectCoupon" resultMap="resultMapObj">
	 select
				a.tvcpSeq
				,a.tvcpName
				,b.tvamLodgingName
				,a.tvcpPrice
				,a.tvcpStartDate
				,a.tvcpEndDate
				,a.tvcpDesc
				,a.tvamSeq
				
				from
				tvCoupon a
				
			left join tvLodging b on a.tvamseq=b.tvamseq
			
			where 
				1=1
				and tvcpDelNy=0
				and b.tvmmSeq= #{tvmmSeq}
				
	</select>
	<select id="selectOneCoupon" resultMap="resultMapObj">
	 select
				a.tvcpSeq
				,a.tvcpName
				,b.tvamLodgingName
				,a.tvcpPrice
				,a.tvcpStartDate
				,a.tvcpEndDate
				,a.tvcpDesc
				,a.regDateTime
				from
				tvCoupon a
			
			left join tvLodging b on a.tvamseq=b.tvamseq
			
			where 
				1=1
				and tvcpDelNy=0
				and tvcpSeq=#{tvcpSeq} 
	</select>

	<select id="selectCouponOption" resultMap="resultMapObj">
	
				select
					tvamLodgingName
					,tvamSeq
				from
					tvLodging
				where
					tvmmSeq=#{tvmmSeq}	
				
	</select>


	<insert id="insertCoupon">
		insert into tvCoupon(
				tvamSeq
				,tvcpName
				,tvcpPrice
				,tvcpStartDate
				,tvcpEndDate
				,tvcpDesc
				,tvcpDelNy
				,regDateTime
			)values(
				#{tvamSeq}
				,#{tvcpName}
				,#{tvcpPrice}
				,#{tvcpStartDate}
				,#{tvcpEndDate}
				,#{tvcpDesc}
				,0
				,now()
			)
	
	
	</insert>


	<update id="updateCoupon">
		update tvCoupon a
			set 
				tvcpName = #{tvcpName}
				
				,tvcpPrice = #{tvcpPrice}
				,a.tvcpStartDate = #{tvcpStartDate}
				,a.tvcpEndDate = #{tvcpEndDate}
				,a.tvcpDesc = #{tvcpDesc}
				
			where 1=1
				and tvcpDelNy=0
				and tvcpSeq=#{tvcpSeq} 
		
	</update>

	<delete id="deleteCoupon">
		delete 
			from tvCoupon a
		where
			tvcpSeq=#{tvcpSeq}
	</delete>

	<!--coupon end -->

	<!--lodging start-->

	<select id="selectLodging" resultMap="resultMapObj">
	 	select
	 			a.tvamSeq
				,a.tvamLodgingName
				,(select tvcdName from tvCode b where a.tvamCategoryCd=b.tvcdSeq) as tvamCategory
				,a.tvamTelNumber
				,a.tvamAddressFull
				,a.tvamMaxPersonCount
				,a.tvamTelNumber
				,a.regDateTime
				from
				tvLodging a
				
			left join tvMember b on a.tvmmseq=b.tvmmseq
			
			
			where 
				1=1
				and tvamDelNy=0
				and a.tvmmSeq = #{tvmmSeq}
				
	</select>

	<select id="selectOneLodging" resultMap="resultMapObj">
	 	select
	 			a.tvamSeq
				,a.tvamLodgingName
				,(select tvcdName from tvCode where a.tvamCategoryCd=tvcdSeq) as tvamCategory
				,a.tvamTelNumber
				,a.tvamAddressFull
				,a.tvamMaxPersonCount
				,a.tvamAdultPrice
				,a.tvamBedCount
				,a.tvamRoomCount
				,a.tvamShowerRoomCount
				,a.tvamCheckInTime
				,a.tvamCheckOutTime
				,a.regDateTime
				,a.tvamDesc
				
				from
				tvLodging a
				
			left join tvMember b on a.tvmmseq=b.tvmmseq
			
			where 
				1=1
				and tvamDelNy=0
				and tvamSeq=#{tvamSeq}
	</select>


	<insert id="insertLodging">
		insert into tvLodging(
				
				tvamLodgingName
				,tvamAddressFull
				,tvamMaxPersonCount
				,tvamCategoryCd
				,tvamTelNumber
				,tvamAdultPrice
				,tvamBedCount
				,tvamRoomCount
				,tvamShowerRoomCount
				,tvamCheckInTime
				,tvamCheckOutTime
				,tvamDesc
				,tvmmSeq
				,tvamDelNy
	
			)values(
				
				#{tvamLodgingName}
				,#{tvamAddressFull}
				,#{tvamMaxPersonCount}
				,#{tvamCategoryCd}
				,#{tvamTelNumber}
				,#{tvamAdultPrice}
				,#{tvamBedCount}
				,#{tvamRoomCount}
				,#{tvamShowerRoomCount}
				,#{tvamCheckInTime}
				,#{tvamCheckOutTime}
				,#{tvamDesc}
				,#{tvmmSeq}
				,0
			)
	
	
	</insert>

	<update id="updateLodging">
		update tvLodging a
			set 
				a.tvamLodgingName =#{tvamLodgingName}
				
				,a.tvamAddressFull =  #{tvamAddressFull}
				,a.tvamMaxPersonCount = #{tvamMaxPersonCount}
				,a.tvamAdultPrice = #{tvamAdultPrice}
				,a.tvamBedCount = #{tvamBedCount}
				,a.tvamRoomCount = #{tvamRoomCount}
				,a.tvamShowerRoomCount = #{tvamShowerRoomCount}
				,a.tvamCheckInTime = #{tvamCheckInTime}
				,a.tvamCheckOutTime = #{tvamCheckOutTime}
				,a.tvamDesc = #{tvamDesc}
				
			where 1=1
				and tvamDelNy=0
				and tvamSeq=#{tvamSeq} 
		
	</update>

	<delete id="deleteLodging">
		delete 
			from tvLodging a
		where
			tvamSeq=#{tvamSeq}
	</delete>

	<!--main-->

	<!--userInfo start-->
	<select id="selectOneHost" resultMap="resultMapObj">
	select
	 
	tvmmName
	,tvmmEmailAccount
	,tvmmPassword
	,tvmmAddressFull
	,tvmmTelNumber
	,tvmmDob
	,regDateTime
	,tvmmDesc
	
	from
		tvMember a
		where 1=1
		and tvmmHostNy=1
		and tvmmSeq=#{tvmmSeq}
		
	</select>

	<update id="updateHost">
	update tvMember
	set
	tvmmName = #{tvmmName}
	,tvmmEmailAccount = #{tvmmEmailAccount}
	,tvmmPassword = #{tvmmPassword}
	,tvmmTelNumber = #{tvmmTelNumber}
	,tvamAddress1 = #{tvmmAddress1} 
	,tvamAddress2 = #{tvmmAddress2}
	,tvmmDob = #{tvmmDob}
	,tvmmDesc = #{tvmmDesc} 
	
	where
		tvmmSeq=#{tvmmSeq}
	</update>

	<!--userInfo End-->


	<!--login Start-->
	<select id="selectOneLogin" resultMap="resultMapObj">
	
	select 
	tvmmSeq
	,tvmmName
	,tvmmEmailAccount
	,tvmmHostNy
	
		
	from
	tvMember
	where tvmmEmailAccount = #{tvmmEmailAccount} and tvmmPassword = #{tvmmPassword}
	
	</select>

	<!--login End-->

	<!--reservation Start-->

	<select id="selectReservation" resultMap="resultMapObj">
	select
		tvpmSeq
		,tvamLodgingName
		,tvpmStartDate
		,tvpmEndDate
		,tvpmtotalPrice
		,tvmmEmailAccount
		,tvmmName
		,tvmmTelNumber
		,tvpmAdNumber
		
	
		
		from tvPayment a
			left join tvMember b on a.tvmmSeq=b.tvmmSeq 
			left join tvLodging c on a.tvamSeq=c.tvamSeq 
		where tvpmDelNy=0 and c.tvmmSeq = #{tvmmSeq}
				
		
	
	</select>
	
	<select id="selectOneReservation" resultMap="resultMapObj">
	
		select 
			a.tvpmSeq
		    , a.tvpmAdNumber
		    , a.tvpmStartDate
		    , a.tvpmEndDate
		    , a.tvpmPrice
		    , a.tvcpSeq
		    , b.tvcpPrice
		    , a.tvpmtotalPrice
		    , a.tvpmPayTypeCd
		    , a.tvpmPrice
		    , a.tvpmDesc
            , a.tvamSeq
            , c.tvamLodgingName
            , c.tvamTelNumber
            , (select tvmmEmailAccount from tvMember e where e.tvmmSeq = c.tvmmSeq) as 'hostEmail' 
            , a.tvmmSeq
            , d.tvmmName
            , d.tvmmTelNumber
            , d.tvmmEmailAccount
            , a.regDateTime
		from tvPayment a
			left join tvCoupon b on a.tvcpSeq = b.tvcpSeq
            left join tvLodging c on a.tvamSeq = c.tvamSeq
            left join tvMember d on a.tvmmSeq = d.tvmmSeq
		where 1 = 1
			and tvpmDelNy = 0
			and tvpmSeq = #{tvpmSeq}
	
	
	</select>
	<update id="updateReservation">
	update
		tvPayment a
		left join tvMember d on a.tvmmSeq = d.tvmmSeq
	set 
		d.tvmmTelNumber = #{tvmmTelNumber}
		,a.tvpmDesc = #{tvpmDesc}
		,a.tvpmAdNumber = #{tvpmAdNumber}
		,a.tvpmStartDate = #{tvpmStartDate}
		,a.tvpmEndDate = #{tvpmEndDate}
			
	
		
        
        
		where tvpmDelNy=0 and tvpmSeq = #{tvpmSeq}
	
	</update>

	<!-- reservation End -->
	
	<!-- host signup start -->
	<insert id="insertHost">
	insert into tvMember(
	
		tvmmName
		,tvmmEmailAccount
		,tvmmPassword
		,tvmmTelNumber
		,tvmmDob
		,tvmmAddress1
		,tvmmAddress2
		,tvmmAddressFull
		,tvmmHostNy
		,tvmmDelNy
		,regDateTime
	)values(
	
		#{tvmmName}
		,#{tvmmEmailAccount}
		,#{tvmmPassword}
		,#{tvmmTelNumber}
		,#{tvmmDob}
		,#{tvmmAddress1}
		,#{tvmmAddress2}
		,concat(#{tvmmAddress1} ," ", #{tvmmAddress2} )
		,1
		,0
		,now()
	)
	
	</insert>
	
	
	<!-- host signup end -->
	
	<!-- paging start-->
	<select id="selectOneCountLodging" resultType="Integer" >	<!-- selectCommon 사용 / 페이징 -->
			select
				count(*)
			from tvLodging
			where tvmmSeq= #{tvmmSeq}
				and tvamDelNy = 0
				
	</select>
	<select id="selectOneCountCoupon" resultType="Integer" >	<!-- selectCommon 사용 / 페이징 -->
			select
				count(*)
			from tvCoupon a
			left join tvLodging b on a.tvamseq=b.tvamseq
			where b.tvmmSeq= #{tvmmSeq}
				and a.tvcpDelNy = 0
				
	</select>
	<select id="selectOneCountReservation" resultType="Integer" >	<!-- selectCommon 사용 / 페이징 -->
			select
				count(*)
			from tvPayment a
			left join tvLodging c on a.tvamSeq=c.tvamSeq 
		where tvpmDelNy=0 and c.tvmmSeq = #{tvmmSeq}
				
	</select>
	<!--paging end-->
	
	<select id="selectOneSales" resultMap="resultMapObj">
		select 
			month(a.regDateTime) as 'month' 
		    , sum(tvpmtotalPrice) as 'sales'
		    , count(tvpmSeq) as 'reservationCount'
		    
		from tvPayment as a
		left join tvLodging b on a.tvamSeq=b.tvamSeq 
		where 1=1 
			and tvpmDelNy = 0
		    and month(a.regDateTime) = 1   
		    and b.tvmmSeq = #{tvmmSeq}  
		 	group by month
	
	</select>
	
</mapper> 